<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard | AI Traffic</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="preconnect" href="https://images.unsplash.com" />
  <!-- Chart.js must load before dashboard.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>
<body class="bg-gradient">
  <div class="glow glow-1"></div>
  <div class="glow glow-2"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-brand">
      <i class="ri-shield-star-line"></i>
      <span class="brand-text">AI Traffic</span>
    </div>
    <nav class="sidebar-nav">
      <button class="nav-item active" data-target="view-dashboard">
        <i class="ri-dashboard-line"></i>
        <span>Dashboard</span>
      </button>

      <div class="nav-group">
        <button class="nav-item has-children" id="violations-toggle" data-target="view-violations">
          <i class="ri-alarm-warning-line"></i>
          <span>Violations</span>
          <i class="ri-arrow-down-s-line chev"></i>
        </button>
        <div class="subnav" id="violations-subnav">
          <button class="subnav-item active" data-type="">All</button>
          <button class="subnav-item" data-type="Overspeeding">Overspeeding</button>
          <button class="subnav-item" data-type="Red Light Jump">Red Light Jump</button>
          <button class="subnav-item" data-type="No Helmet">No Helmet</button>
          <button class="subnav-item" data-type="Wrong Lane">Wrong Lane</button>
        </div>
      </div>

      <button class="nav-item" data-target="view-analysis">
        <i class="ri-line-chart-line"></i>
        <span>Analysis</span>
      </button>
      <button class="nav-item" data-target="view-reports">
        <i class="ri-file-chart-line"></i>
        <span>Reports</span>
      </button>
    </nav>
    <div class="sidebar-footer">
      <button id="collapse-btn" class="pill-btn mini outlined" title="Collapse sidebar">
        <i class="ri-layout-left-line"></i>
      </button>
    </div>
  </aside>

  <!-- Main content -->
  <div class="content">
    <header class="topbar glass-card">
      <button id="burger" class="icon-btn" aria-label="Toggle Sidebar">
        <i class="ri-menu-line"></i>
      </button>
      <h1 id="page-title">Dashboard</h1>
      <div class="topbar-actions">
        <div class="user-badge">
          <i class="ri-user-3-line"></i>
          <span id="user-email">admin@traffic.ai</span>
        </div>
        <button id="logout-btn" class="pill-btn danger">
          <i class="ri-logout-circle-r-line"></i> Logout
        </button>
      </div>
    </header>

    <main class="main">
      <!-- DASHBOARD VIEW -->
      <section id="view-dashboard" class="view active">
        <div class="grid grid-4">
          <div class="stat-card glass-card">
            <div class="stat-icon"><i class="ri-alert-line"></i></div>
            <div class="stat-content">
              <p>Total Violations</p>
              <h2 id="stat-violations">0</h2>
            </div>
          </div>
          <div class="stat-card glass-card">
            <div class="stat-icon"><i class="ri-wallet-3-line"></i></div>
            <div class="stat-content">
              <p>Pending Payments</p>
              <h2 id="stat-pending">0</h2>
            </div>
          </div>
          <div class="stat-card glass-card">
            <div class="stat-icon"><i class="ri-bank-card-line"></i></div>
            <div class="stat-content">
              <p>Amount Paid</p>
              <h2 id="stat-paid">₹0</h2>
            </div>
          </div>
          <div class="stat-card glass-card">
            <div class="stat-icon"><i class="ri-cash-line"></i></div>
            <div class="stat-content">
              <p>Amount Due</p>
              <h2 id="stat-due">₹0</h2>
            </div>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="glass-card chart-card">
            <div class="card-head"><h3>Violations (Monthly)</h3></div>
            <canvas id="violationsChart" height="120"></canvas>
          </div>
          <div class="glass-card chart-card">
            <div class="card-head"><h3>Payments Overview</h3></div>
            <canvas id="paymentsChart" height="120"></canvas>
            <div class="progress-wrap">
              <div class="progress-row">
                <span>Collected</span>
                <div class="progress"><div id="prog-collected" class="progress-bar" style="--val:60%"></div></div>
              </div>
              <div class="progress-row">
                <span>Outstanding</span>
                <div class="progress"><div id="prog-outstanding" class="progress-bar alt" style="--val:40%"></div></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent violations table -->
        <div class="glass-card">
          <div class="card-head">
            <h3>Recent Violations</h3>
            <button class="pill-btn small outlined" data-target="view-violations">View all</button>
          </div>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Violator</th>
                  <th>Vehicle No.</th>
                  <th>Type</th>
                  <th>Area</th>
                  <th>Proof</th>
                  <th>Date</th>
                  <th class="right">Fine</th>
                  <th class="center">Status</th>
                  <th class="right">Actions</th>
                </tr>
              </thead>
              <tbody id="recent-violations-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- VIOLATIONS VIEW -->
      <section id="view-violations" class="view">
        <div class="glass-card">
          <div class="card-head">
            <h3 id="violations-title">Violations</h3>
            <div class="controls">
              <input id="search" class="input" type="text" placeholder="Search name, vehicle, area, or type..." />
              <select id="status-filter" class="input">
                <option value="">All Status</option>
                <option value="Paid">Paid</option>
                <option value="Pending">Pending</option>
                <option value="Overdue">Overdue</option>
              </select>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table" id="violationTable">
              <thead>
                <tr>
                  <th>Violator</th>
                  <th>Vehicle No.</th>
                  <th>Type</th>
                  <th>Area</th>
                  <th>Proof</th>
                  <th>Date</th>
                  <th class="right">Fine</th>
                  <th class="center">Status</th>
                  <th class="right">Actions</th>
                </tr>
              </thead>
              <tbody id="violations-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ANALYSIS VIEW -->
      <section id="view-analysis" class="view">
        <div class="grid grid-2">
          <div class="glass-card chart-card">
            <div class="card-head"><h3>Violations by Area</h3></div>
            <canvas id="areasChart" height="120"></canvas>
          </div>
          <div class="glass-card chart-card">
            <div class="card-head"><h3>Violations by Type</h3></div>
            <canvas id="violationTypeChart" height="120"></canvas>
          </div>
        </div>
        <div class="glass-card">
          <div class="card-head"><h3>Area Heat Tiles</h3></div>
          <div id="heat-tiles" class="heat-tiles"></div>
        </div>
      </section>

      <!-- REPORTS VIEW -->
      <section id="view-reports" class="view">
        <div class="glass-card">
          <div class="card-head"><h3>Reports</h3></div>
          <div class="grid grid-3">
            <div class="report-card">
              <i class="ri-download-2-line"></i>
              <div>
                <h4>Export Violations (CSV)</h4>
                <p>Download full violation table.</p>
              </div>
              <button id="download-csv" class="pill-btn small">Download CSV</button>
            </div>
            <div class="report-card">
              <i class="ri-map-pin-2-line"></i>
              <div>
                <h4>Area Summary (CSV)</h4>
                <p>Area-wise violation counts.</p>
              </div>
              <button id="download-areas" class="pill-btn small">Download Areas</button>
            </div>
            <div class="report-card">
              <i class="ri-bar-chart-2-line"></i>
              <div>
                <h4>Type Summary (CSV)</h4>
                <p>Mode-wise counts.</p>
              </div>
              <button id="download-types" class="pill-btn small">Download Types</button>
            </div>
          </div>

          <div class="glass-card inner mt-12">
            <div class="card-head"><h3>Monthly Snapshot</h3></div>
            <div class="mini-metrics">
              <div><span>Violations</span><strong id="rep-violations">0</strong></div>
              <div><span>Paid</span><strong id="rep-paid">₹0</strong></div>
              <div><span>Due</span><strong id="rep-due">₹0</strong></div>
            </div>
            <div class="actions mt-12">
              <button class="pill-btn small outlined" onclick="window.print()">
                <i class="ri-printer-line"></i> Print as PDF
              </button>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Proof Modal -->
  <div id="proof-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="proof-title" aria-hidden="true">
    <div class="modal-dialog glass-card">
      <div class="modal-head">
        <h3 id="proof-title">Violation Details</h3>
        <button id="modal-close" class="icon-btn"><i class="ri-close-line"></i></button>
      </div>
      <div class="modal-body">
        <div class="proof-grid">
          <div class="proof-images">
            <img id="proof-image" alt="Violation proof image" />
            <div class="thumbs">
              <img id="proof-plate" alt="Plate crop" />
            </div>
          </div>
          <div class="proof-info">
            <div class="kv"><span>Violator</span><strong id="proof-name">-</strong></div>
            <div class="kv"><span>Vehicle</span><strong id="proof-vehicle">-</strong></div>
            <div class="kv"><span>Type</span><strong id="proof-type">-</strong></div>
            <div class="kv"><span>Area</span><strong id="proof-area">-</strong></div>
            <div class="kv"><span>Date</span><strong id="proof-date">-</strong></div>
            <div class="kv"><span>Fine</span><strong id="proof-fine">-</strong></div>
            <div class="kv"><span>Status</span><strong id="proof-status">-</strong></div>
            <div class="kv"><span>Camera</span><strong id="proof-camera">-</strong></div>
            <div class="kv"><span>Speed</span><strong id="proof-speed">-</strong></div>
            <div class="mt-12">
              <button id="proof-mark-paid" class="pill-btn small"><i class="ri-check-double-line"></i> Mark Paid</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main script (loads after Chart.js) -->
  <script defer src="js/dashboard.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script defer src="js/dashboard.js"></script>

</body>
</html>